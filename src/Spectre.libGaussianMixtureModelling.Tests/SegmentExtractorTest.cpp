/*
* SegmentExtractorTest.cpp
* Tests the segment extractor.
*
Copyright 2018 Michal Gallus

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
#define GTEST_LANG_CXX11 1

#include <gtest/gtest.h>
#include "Spectre.libGaussianMixtureModelling/SegmentExtractor.h"

namespace spectre::unsupervised::gmm
{
class SegmentExtractorTest : public ::testing::Test
{
public:
    SegmentExtractorTest()
    {
    }
protected:
};

TEST_F(SegmentExtractorTest, correctly_decomposes_first_segment)
{
    constexpr DataType MAX_ERROR = 0.0001;

    Spectrum spectrum;
    spectrum.mzs = {
        2000.00000000000, 2000.80008000800, 2001.60016001600, 2002.40024002400,
        2003.20032003200, 2004.00040004000, 2004.80048004800, 2005.60056005601,
        2006.40064006401, 2007.20072007201, 2008.00080008001, 2008.80088008801,
        2009.60096009601, 2010.40104010401, 2011.20112011201, 2012.00120012001,
        2012.80128012801, 2013.60136013601, 2014.40144014401, 2015.20152015202,
        2016.00160016002, 2016.80168016802, 2017.60176017602, 2018.40184018402,
        2019.20192019202, 2020.00200020002, 2020.80208020802, 2021.60216021602,
        2022.40224022402, 2023.20232023202, 2024.00240024002, 2024.80248024802,
        2025.60256025603, 2026.40264026403, 2027.20272027203, 2028.00280028003,
        2028.80288028803, 2029.60296029603, 2030.40304030403, 2031.20312031203,
        2032.00320032003, 2032.80328032803, 2033.60336033603, 2034.40344034403,
        2035.20352035204, 2036.00360036004, 2036.80368036804, 2037.60376037604,
        2038.40384038404, 2039.20392039204, 2040.00400040004, 2040.80408040804,
        2041.60416041604, 2042.40424042404, 2043.20432043204, 2044.00440044004,
        2044.80448044804, 2045.60456045605, 2046.40464046405, 2047.20472047205,
        2048.00480048005, 2048.80488048805, 2049.60496049605, 2050.40504050405,
        2051.20512051205, 2052.00520052005, 2052.80528052805, 2053.60536053605,
        2054.40544054405, 2055.20552055206, 2056.00560056006, 2056.80568056806,
        2057.60576057606, 2058.40584058406, 2059.20592059206, 2060.00600060006,
        2060.80608060806, 2061.60616061606, 2062.40624062406, 2063.20632063206,
        2064.00640064006, 2064.80648064806, 2065.60656065607, 2066.40664066407,
        2067.20672067207, 2068.00680068007, 2068.80688068807, 2069.60696069607,
        2070.40704070407, 2071.20712071207, 2072.00720072007, 2072.80728072807,
        2073.60736073607, 2074.40744074407, 2075.20752075208, 2076.00760076008,
        2076.80768076808, 2077.60776077608, 2078.40784078408, 2079.20792079208,
        2080.00800080008, 2080.80808080808, 2081.60816081608, 2082.40824082408,
        2083.20832083208, 2084.00840084008, 2084.80848084809, 2085.60856085609,
        2086.40864086409, 2087.20872087209, 2088.00880088009, 2088.80888088809,
        2089.60896089609, 2090.40904090409, 2091.20912091209, 2092.00920092009,
        2092.80928092809, 2093.60936093609, 2094.40944094409, 2095.20952095210,
        2096.00960096010, 2096.80968096810, 2097.60976097610, 2098.40984098410,
        2099.20992099210, 2100.01000100010, 2100.81008100810, 2101.61016101610,
        2102.41024102410, 2103.21032103210, 2104.01040104010, 2104.81048104811,
        2105.61056105611, 2106.41064106411, 2107.21072107211, 2108.01080108011,
        2108.81088108811, 2109.61096109611, 2110.41104110411, 2111.21112111211,
        2112.01120112011, 2112.81128112811, 2113.61136113611, 2114.41144114411,
        2115.21152115212, 2116.01160116012, 2116.81168116812, 2117.61176117612,
        2118.41184118412, 2119.21192119212, 2120.01200120012, 2120.81208120812,
        2121.61216121612, 2122.41224122412, 2123.21232123212, 2124.01240124012,
        2124.81248124812, 2125.61256125613, 2126.41264126413, 2127.21272127213,
        2128.01280128013, 2128.81288128813, 2129.61296129613, 2130.41304130413,
        2131.21312131213, 2132.01320132013, 2132.81328132813, 2133.61336133613,
        2134.41344134413, 2135.21352135214, 2136.01360136014, 2136.81368136814,
        2137.61376137614, 2138.41384138414, 2139.21392139214, 2140.01400140014,
        2140.81408140814, 2141.61416141614, 2142.41424142414, 2143.21432143214,
        2144.01440144014, 2144.81448144814, 2145.61456145615, 2146.41464146415,
        2147.21472147215, 2148.01480148015, 2148.81488148815, 2149.61496149615,
        2150.41504150415, 2151.21512151215, 2152.01520152015, 2152.81528152815,
        2153.61536153615, 2154.41544154415, 2155.21552155216, 2156.01560156016,
        2156.81568156816, 2157.61576157616, 2158.41584158416, 2159.21592159216,
        2160.01600160016, 2160.81608160816, 2161.61616161616, 2162.41624162416,
        2163.21632163216, 2164.01640164016, 2164.81648164817, 2165.61656165617,
        2166.41664166417, 2167.21672167217, 2168.01680168017, 2168.81688168817,
        2169.61696169617, 2170.41704170417, 2171.21712171217, 2172.01720172017,
        2172.81728172817,
    };
    spectrum.intensities = {
        0, 0, 0, 0, 0, 0.00313896763865884, 0.471441652934461, 0.672030678788723,
        0.816262002801366, 1.08915090226750, 0.908525574332631, 1.09942659964331,
        1.00831471686859, 0.898924784053919, 0.830397142089201, 0.921254469136256,
        0.809914526511511, 0.495504714920023, 1.05933645531290, 0.715764166159622,
        0.654187646945404, 0.833199942407827, 0.472595554612829, 0.718948317424693,
        0.202560913964748, 0.512811386708187, 0.153311309685319, 0.793625363077548,
        0.435753748045594, 0.394305054377424, 0.535609833834569, 0.240742736542648,
        0.387432851938412, 0.581676305935098, 0.251998227512921, 0.437725964408568,
        0.299204203319242, 0.386115747151888, 0.0515198664285381, 0.444600759614117,
        0.0639361145978792, 0.342632162977885, 0.276130057228110, 0.207216215629398,
        0.159000891995082, 0.340759880325978, 0.340907819950338, 0.0752842833854910,
        0.347991930113223, 0.0655464814652516, 0.0535377938634696,
        0.128621425265965, 0.00440900747876283, 0.547525466603544,
        0.0462087396643245, 0.206736722218696, 0.298919157730883, 0.351887452803929,
        0.221942250929720, 0.0498827295799202, 0.322057711010452, 0.161881211035329,
        0.446876732255314, 0.182970463954745, 0.153766118805060, 0,
        0.287548761839049, 0.512123839022823, 0.186824480511958, 0.179939042464079,
        0, 0.136815906257107, 0.185978281818155, 0, 0.484017412267977,
        0.339418339719114, 0.531544946658384, 0.688042523875261, 1.34163313658041,
        1.41343838963380, 2.56441964254438, 3.48553707573873, 4.77091832781994,
        6.67204533882371, 8.03991968146468, 9.98593853528940, 11.3240442419170,
        12.5613998608927, 13.7376502011761, 13.4248779885916, 12.6472694717968,
        11.5196552268043, 10.5285850658990, 8.41731591419851, 6.47564575313087,
        5.58747738339363, 4.04115299837117, 2.79329356694543, 1.83514133765118,
        1.11597252660942, 0.766239641113877, 0.513732841123777, 0.346710783640829,
        0.453926288540250, 0, 0.298585462364539, 0.188908177104015, 0,
        0.380566263007272, 0.207680789399876, 0.110507439129649, 0.0832567555737356,
        0.165409332028748, 0.185605135114612, 0.219507662840845, 0.380311951491821,
        0.154004273557106, 0.378592237262633, 0.0589452781682507, 0,
        0.283578960805238, 0.243027948124485, 0.153480502037719, 0.231274299584042,
        0.565708003178639, 0.0845741327545553, 0.363814250712118, 0.530574138576480,
        0.450242351634906, 0.278465187341858, 0.360944309566526, 0.536542189711439,
        0.557343781971436, 0.261807240564701, 0.359553640289308,
        0.00295847497307244, 0.443706843804907, 0.436934799504090,
        0.214428108181404, 0.469840546122176, 0.183786549444292, 0.356344468117616,
        0.498398033291890, 0.579800528843963, 0.235528580139978, 0.425006089807245,
        0.418877168608038, 0.586111885878723, 0.421885698327960, 0.393189119330898,
        0.153915392227581, 0.289274069495940, 0.633389783852282, 0.334325185622669,
        0.714250658695391, 0.373174236965407, 0.549606704736641, 0.568763807499102,
        0.528982577133316, 0.215236083423240, 0.509255983624142, 0.313185342444855,
        0.657083190191125, 0.481111033017786, 0.230366801502450, 0.793712451251984,
        0.604310478317509, 0.275698055496782, 0.833571126992267, 0.404651161912478,
        0.474211011821594, 0.512414016524425, 0.434053811340302, 0.694180243213424,
        0.628647911765159, 0.476179942834389, 0.269951308147264, 0.426418137132319,
        0.301456816413510, 0.520458522853752, 0.440846526768305, 0.456439612095708,
        0.455179491074684, 0.513236419097895, 0.515741955447879, 0.376053200545569,
        0.235858777787196, 0.878625776015537, 0.361285406151753, 0.511426112346159,
        0.0976358390677712, 0.487442029178184, 0.472710043762935, 0.600920541597815,
        0.494144789702100, 0.229277018204003, 0.278545152253129, 0.331778027778054,
        0.386725619772055, 0.397401507822554, 0.274924844281347, 0.502904731071679,
        0.548361788492896, 0.749320032582061, 0.850872576261417, 1.28708518242974,
        1.31550784822034, 1.82727389365701, 2.44858664173529, 2.78032398633831,
        4.24851166333781, 5.28667967857275, 6.61248438056384, 7.55880264777807,
        8.95384776440258, 9.78130521847610, 10.322581560435
    };

    Splitters splitters = { // Splitters container
        { // Spliter (mean)          (std)            (height)
            { 2166.39128284907, 5.05652813570466, 10.2636297087738 },
            { 2172.91522875294, 3.24560604541697, 67.3698793267690 },
            { 2173.32105656936, 4.51492766334954, 15.3342036804303 },
            { 2194.19130344853, 9.29550017181743, 2.58282898673850 },
        }
    };

    const Indices peakIndices = { 0, 0, 0, 0, 0, 0, 0, 216 };
    const Indices clearPeakIndices = { 7 };
    const Index segmentIndex = 0;

    Spectrum segment = ExtractSegment(spectrum, peakIndices, clearPeakIndices,
        segmentIndex, splitters);

    constexpr size_t correctSegmentLength = 194;
    ASSERT_EQ(correctSegmentLength, segment.mzs.size());

    EXPECT_NEAR(2004.00040004000, segment.mzs[0], MAX_ERROR);
    EXPECT_NEAR(2004.80048004800, segment.mzs[1], MAX_ERROR);
    EXPECT_NEAR(2005.60056005601, segment.mzs[2], MAX_ERROR);
    EXPECT_NEAR(2164.01640164016, segment.mzs[191], MAX_ERROR);
    EXPECT_NEAR(2165.61656165617, segment.mzs[192], MAX_ERROR);
    EXPECT_NEAR(2166.41664166417, segment.mzs[193], MAX_ERROR);

    EXPECT_NEAR(0.00313896763865884, segment.intensities[0], MAX_ERROR);
    EXPECT_NEAR(0.47144165293446100, segment.intensities[1], MAX_ERROR);
    EXPECT_NEAR(0.67203067878872300, segment.intensities[2], MAX_ERROR);
    EXPECT_NEAR(0.20620644785319800, segment.intensities[191], MAX_ERROR);
    EXPECT_NEAR(0.04940960259199770, segment.intensities[192], MAX_ERROR);
    EXPECT_NEAR(0.10110831057777300, segment.intensities[193], MAX_ERROR);
}

TEST_F(SegmentExtractorTest, correctly_decomposes_middle_segment)
{
    constexpr DataType MAX_ERROR = 0.0001;

    Spectrum spectrum;
    spectrum.mzs = {
        2000.00000000000, 2000.80008000800, 2001.60016001600, 2002.40024002400,
        2003.20032003200, 2004.00040004000, 2004.80048004800, 2005.60056005601,
        2006.40064006401, 2007.20072007201, 2008.00080008001, 2008.80088008801,
        2009.60096009601, 2010.40104010401, 2011.20112011201, 2012.00120012001,
        2012.80128012801, 2013.60136013601, 2014.40144014401, 2015.20152015202,
        2016.00160016002, 2016.80168016802, 2017.60176017602, 2018.40184018402,
        2019.20192019202, 2020.00200020002, 2020.80208020802, 2021.60216021602,
        2022.40224022402, 2023.20232023202, 2024.00240024002, 2024.80248024802,
        2025.60256025603, 2026.40264026403, 2027.20272027203, 2028.00280028003,
        2028.80288028803, 2029.60296029603, 2030.40304030403, 2031.20312031203,
        2032.00320032003, 2032.80328032803, 2033.60336033603, 2034.40344034403,
        2035.20352035204, 2036.00360036004, 2036.80368036804, 2037.60376037604,
        2038.40384038404, 2039.20392039204, 2040.00400040004, 2040.80408040804,
        2041.60416041604, 2042.40424042404, 2043.20432043204, 2044.00440044004,
        2044.80448044804, 2045.60456045605, 2046.40464046405, 2047.20472047205,
        2048.00480048005, 2048.80488048805, 2049.60496049605, 2050.40504050405,
        2051.20512051205, 2052.00520052005, 2052.80528052805, 2053.60536053605,
        2054.40544054405, 2055.20552055206, 2056.00560056006, 2056.80568056806,
        2057.60576057606, 2058.40584058406, 2059.20592059206, 2060.00600060006,
        2060.80608060806, 2061.60616061606, 2062.40624062406, 2063.20632063206,
        2064.00640064006, 2064.80648064806, 2065.60656065607, 2066.40664066407,
        2067.20672067207, 2068.00680068007, 2068.80688068807, 2069.60696069607,
        2070.40704070407, 2071.20712071207, 2072.00720072007, 2072.80728072807,
        2073.60736073607, 2074.40744074407, 2075.20752075208, 2076.00760076008,
        2076.80768076808, 2077.60776077608, 2078.40784078408, 2079.20792079208,
        2080.00800080008, 2080.80808080808, 2081.60816081608, 2082.40824082408,
        2083.20832083208, 2084.00840084008, 2084.80848084809, 2085.60856085609,
        2086.40864086409, 2087.20872087209, 2088.00880088009, 2088.80888088809,
        2089.60896089609, 2090.40904090409, 2091.20912091209, 2092.00920092009,
        2092.80928092809, 2093.60936093609, 2094.40944094409, 2095.20952095210,
        2096.00960096010, 2096.80968096810, 2097.60976097610, 2098.40984098410,
        2099.20992099210, 2100.01000100010, 2100.81008100810, 2101.61016101610,
        2102.41024102410, 2103.21032103210, 2104.01040104010, 2104.81048104811,
        2105.61056105611, 2106.41064106411, 2107.21072107211, 2108.01080108011,
        2108.81088108811, 2109.61096109611, 2110.41104110411, 2111.21112111211,
        2112.01120112011, 2112.81128112811, 2113.61136113611, 2114.41144114411,
        2115.21152115212, 2116.01160116012, 2116.81168116812, 2117.61176117612,
        2118.41184118412, 2119.21192119212, 2120.01200120012, 2120.81208120812,
        2121.61216121612, 2122.41224122412, 2123.21232123212, 2124.01240124012,
        2124.81248124812, 2125.61256125613, 2126.41264126413, 2127.21272127213,
        2128.01280128013, 2128.81288128813, 2129.61296129613, 2130.41304130413,
        2131.21312131213, 2132.01320132013, 2132.81328132813, 2133.61336133613,
        2134.41344134413, 2135.21352135214, 2136.01360136014, 2136.81368136814,
        2137.61376137614, 2138.41384138414, 2139.21392139214, 2140.01400140014,
        2140.81408140814, 2141.61416141614, 2142.41424142414, 2143.21432143214,
        2144.01440144014, 2144.81448144814, 2145.61456145615, 2146.41464146415,
        2147.21472147215, 2148.01480148015, 2148.81488148815, 2149.61496149615,
        2150.41504150415, 2151.21512151215, 2152.01520152015, 2152.81528152815,
        2153.61536153615, 2154.41544154415, 2155.21552155216, 2156.01560156016,
        2156.81568156816, 2157.61576157616, 2158.41584158416, 2159.21592159216,
        2160.01600160016, 2160.81608160816, 2161.61616161616, 2162.41624162416,
        2163.21632163216, 2164.01640164016, 2164.81648164817, 2165.61656165617,
        2166.41664166417, 2167.21672167217, 2168.01680168017, 2168.81688168817,
        2169.61696169617, 2170.41704170417, 2171.21712171217, 2172.01720172017,
        2172.81728172817,
        2172.81728172817, 2173.61736173617, 2174.41744174417, 2175.21752175218,
        2176.01760176018, 2176.81768176818, 2177.61776177618, 2178.41784178418,
        2179.21792179218, 2180.01800180018, 2180.81808180818, 2181.61816181618,
        2182.41824182418, 2183.21832183218, 2184.01840184018, 2184.81848184819,
        2185.61856185619, 2186.41864186419, 2187.21872187219, 2188.01880188019,
        2188.81888188819, 2189.61896189619, 2190.41904190419, 2191.21912191219,
        2192.01920192019, 2192.81928192819, 2193.61936193619, 2194.41944194419,
        2195.21952195220, 2196.01960196020, 2196.81968196820, 2197.61976197620,
        2198.41984198420, 2199.21992199220, 2200.02000200020, 2200.82008200820,
        2201.62016201620, 2202.42024202420, 2203.22032203220, 2204.02040204020,
        2204.82048204820, 2205.62056205621, 2206.42064206421, 2207.22072207221,
        2208.02080208021, 2208.82088208821, 2209.62096209621, 2210.42104210421,
        2211.22112211221, 2212.02120212021, 2212.82128212821, 2213.62136213621,
        2214.42144214421, 2215.22152215222, 2216.02160216022, 2216.82168216822,
        2217.62176217622, 2218.42184218422, 2219.22192219222, 2220.02200220022,
        2220.82208220822, 2221.62216221622, 2222.42224222422, 2223.22232223222,
        2224.02240224022, 2224.82248224823, 2225.62256225623, 2226.42264226423,
        2227.22272227223, 2228.02280228023, 2228.82288228823, 2229.62296229623,
        2230.42304230423, 2231.22312231223, 2232.02320232023, 2232.82328232823,
        2233.62336233623, 2234.42344234423, 2235.22352235224, 2236.02360236024,
        2236.82368236824, 2237.62376237624, 2238.42384238424, 2239.22392239224,
        2240.02400240024, 2240.82408240824, 2241.62416241624, 2242.42424242424,
        2243.22432243224, 2244.02440244024, 2244.82448244825, 2245.62456245625,
        2246.42464246425, 2247.22472247225, 2248.02480248025, 2248.82488248825,
        2249.62496249625, 2250.42504250425, 2251.22512251225, 2252.02520252025,
        2252.82528252825, 2253.62536253625, 2254.42544254425, 2255.22552255226,
        2256.02560256026, 2256.82568256826, 2257.62576257626, 2258.42584258426,
        2259.22592259226, 2260.02600260026, 2260.82608260826, 2261.62616261626,
        2262.42624262426, 2263.22632263226, 2264.02640264026, 2264.82648264826,
        2265.62656265627, 2266.42664266427, 2267.22672267227, 2268.02680268027,
        2268.82688268827, 2269.62696269627, 2270.42704270427, 2271.22712271227,
        2272.02720272027, 2272.82728272827, 2273.62736273627, 2274.42744274427,
        2275.22752275228, 2276.02760276028, 2276.82768276828, 2277.62776277628,
        2278.42784278428, 2279.22792279228, 2280.02800280028, 2280.82808280828,
        2281.62816281628, 2282.42824282428, 2283.22832283228, 2284.02840284028,
        2284.82848284828, 2285.62856285629, 2286.42864286429, 2287.22872287229,
        2288.02880288029, 2288.82888288829, 2289.62896289629, 2290.42904290429,
        2291.22912291229, 2292.02920292029, 2292.82928292829, 2293.62936293629,
        2294.42944294429, 2295.22952295230, 2296.02960296030, 2296.82968296830,
        2297.62976297630, 2298.42984298430, 2299.22992299230, 2300.03000300030,
    };
    spectrum.intensities = {
        0, 0, 0, 0, 0, 0.00313896763865884, 0.471441652934461, 0.672030678788723,
        0.816262002801366, 1.08915090226750, 0.908525574332631, 1.09942659964331,
        1.00831471686859, 0.898924784053919, 0.830397142089201, 0.921254469136256,
        0.809914526511511, 0.495504714920023, 1.05933645531290, 0.715764166159622,
        0.654187646945404, 0.833199942407827, 0.472595554612829, 0.718948317424693,
        0.202560913964748, 0.512811386708187, 0.153311309685319, 0.793625363077548,
        0.435753748045594, 0.394305054377424, 0.535609833834569, 0.240742736542648,
        0.387432851938412, 0.581676305935098, 0.251998227512921, 0.437725964408568,
        0.299204203319242, 0.386115747151888, 0.0515198664285381, 0.444600759614117,
        0.0639361145978792, 0.342632162977885, 0.276130057228110, 0.207216215629398,
        0.159000891995082, 0.340759880325978, 0.340907819950338, 0.0752842833854910,
        0.347991930113223, 0.0655464814652516, 0.0535377938634696,
        0.128621425265965, 0.00440900747876283, 0.547525466603544,
        0.0462087396643245, 0.206736722218696, 0.298919157730883, 0.351887452803929,
        0.221942250929720, 0.0498827295799202, 0.322057711010452, 0.161881211035329,
        0.446876732255314, 0.182970463954745, 0.153766118805060, 0,
        0.287548761839049, 0.512123839022823, 0.186824480511958, 0.179939042464079,
        0, 0.136815906257107, 0.185978281818155, 0, 0.484017412267977,
        0.339418339719114, 0.531544946658384, 0.688042523875261, 1.34163313658041,
        1.41343838963380, 2.56441964254438, 3.48553707573873, 4.77091832781994,
        6.67204533882371, 8.03991968146468, 9.98593853528940, 11.3240442419170,
        12.5613998608927, 13.7376502011761, 13.4248779885916, 12.6472694717968,
        11.5196552268043, 10.5285850658990, 8.41731591419851, 6.47564575313087,
        5.58747738339363, 4.04115299837117, 2.79329356694543, 1.83514133765118,
        1.11597252660942, 0.766239641113877, 0.513732841123777, 0.346710783640829,
        0.453926288540250, 0, 0.298585462364539, 0.188908177104015, 0,
        0.380566263007272, 0.207680789399876, 0.110507439129649, 0.0832567555737356,
        0.165409332028748, 0.185605135114612, 0.219507662840845, 0.380311951491821,
        0.154004273557106, 0.378592237262633, 0.0589452781682507, 0,
        0.283578960805238, 0.243027948124485, 0.153480502037719, 0.231274299584042,
        0.565708003178639, 0.0845741327545553, 0.363814250712118, 0.530574138576480,
        0.450242351634906, 0.278465187341858, 0.360944309566526, 0.536542189711439,
        0.557343781971436, 0.261807240564701, 0.359553640289308,
        0.00295847497307244, 0.443706843804907, 0.436934799504090,
        0.214428108181404, 0.469840546122176, 0.183786549444292, 0.356344468117616,
        0.498398033291890, 0.579800528843963, 0.235528580139978, 0.425006089807245,
        0.418877168608038, 0.586111885878723, 0.421885698327960, 0.393189119330898,
        0.153915392227581, 0.289274069495940, 0.633389783852282, 0.334325185622669,
        0.714250658695391, 0.373174236965407, 0.549606704736641, 0.568763807499102,
        0.528982577133316, 0.215236083423240, 0.509255983624142, 0.313185342444855,
        0.657083190191125, 0.481111033017786, 0.230366801502450, 0.793712451251984,
        0.604310478317509, 0.275698055496782, 0.833571126992267, 0.404651161912478,
        0.474211011821594, 0.512414016524425, 0.434053811340302, 0.694180243213424,
        0.628647911765159, 0.476179942834389, 0.269951308147264, 0.426418137132319,
        0.301456816413510, 0.520458522853752, 0.440846526768305, 0.456439612095708,
        0.455179491074684, 0.513236419097895, 0.515741955447879, 0.376053200545569,
        0.235858777787196, 0.878625776015537, 0.361285406151753, 0.511426112346159,
        0.0976358390677712, 0.487442029178184, 0.472710043762935, 0.600920541597815,
        0.494144789702100, 0.229277018204003, 0.278545152253129, 0.331778027778054,
        0.386725619772055, 0.397401507822554, 0.274924844281347, 0.502904731071679,
        0.548361788492896, 0.749320032582061, 0.850872576261417, 1.28708518242974,
        1.31550784822034, 1.82727389365701, 2.44858664173529, 2.78032398633831,
        4.24851166333781, 5.28667967857275, 6.61248438056384, 7.55880264777807,
        8.95384776440258, 9.78130521847610, 10.322581560435,
        10.3225815604355, 10.0255291682811, 8.89254971708995, 7.69004784060688,
        6.40751494646264, 5.13456492698703, 3.60509100193144, 2.78414228847203,
        2.02153221957529, 1.32282513138409, 0.902639040231044, 0.472400437658552,
        0.370300174663148, 0.274423775317556, 0.0500022864185772, 0.248729924519168,
        0, 0.0742830491287789, 0.183247113604797, 0, 0.264531948108303, 0,
        0.229133105123512, 0.123872861906422, 0, 0, 0.110332008830386, 0,
        0.437734094645375, 0.0383989079033633, 0.0688598159638985, 0,
        0.139642505194912, 0.152766542675404, 0.216602740680973, 0, 0,
        0.0109220433973314, 0.289934877315602, 0.0612025622795123,
        0.0881055791916359, 0.282267917872234, 0, 0.455546499813490,
        0.272441096699381, 0.860595358207989, 0.782394599354565, 1.62475024433638,
        1.84297885307022, 3.00673486787108, 4.43533715665404, 5.98377426051030,
        8.00095014326026, 10.6152825147568, 13.3641750902087, 15.5745490840085,
        18.3647686729163, 21.3615205544598, 22.0657068414391, 23.0321165720462,
        23.0999048988750, 22.2919478705738, 20.8046159391778, 18.5775019646341,
        15.5076576598391, 13.9986450163468, 12.1915132401783, 9.01208452848286,
        7.89223994808403, 6.40707561796249, 4.99185032798957, 3.93003844731568,
        2.54699848141804, 2.01612000269646, 1.13389552599630, 1.04241529165316,
        0.803522398623144, 0.304487965114115, 0.415321925886313, 0.381478154663490,
        0.283395520133245, 0.532117970960521, 0.0241553342805583, 0.330850904436683,
        0.197372802506284, 0.194093687609676, 0.617869601781809, 0,
        0.317124777538457, 0.0364600053699531, 0.324120137093647, 0.218569191305120,
        0.263666467439547, 0.224484410513773, 0.227366738118689, 0.242099342337039,
        0.599474963839644, 0.294579717364781, 0.492076698564628, 0.407680909046070,
        0.403437535155847, 0.373369559624027, 0.395753327747644, 0,
        0.875144559139126, 0.00100712264422542, 0.511037701239382,
        0.288605316923815, 0.207457248860628, 0.116378323745673, 0.407789754676676,
        0.255064709044987, 0.484943075964991, 0.200794137406213, 0.172250831253579,
        0.396670471742894, 0.292169338837134, 0.351690388722248,
        0.00597262709847302, 0.327589313424677, 0.394628702498820,
        0.322290110807625, 0.207710959110847, 0.476054008282907, 0.513580445131273,
        0.214311835988537, 0.332500763434499, 0.298289302042424, 0.0831050342084347,
        0.267469105423929, 0.594289112609474, 0.267276733879892, 0.698007016107988,
        1.47281084616622, 2.22396365238881, 3.69052390228060, 5.26224690001302,
        8.83081386622397, 11.9120341370221, 15.3829338531252, 20.2460150122713,
        24.8759706743517, 28.6201109846616, 33.1222407272267, 37.2574092568072,
        42.1324376785350, 48.1243151954534, 53.8648994743175, 60.8757274527638,
        69.5810107968571, 76.6083288333135, 85.8335263452788, 97.1822170500435,
        107.555989820719, 115.293042453721, 121.986005313720, 127.481066439459,
        130.258045957281, 132.570256065102, 133.733573398942
    };

    Splitters splitters = { // Splitters container
        { // Spliter (mean)          (std)            (height)
            { 2166.39128284907, 5.05652813570466, 10.2636297087738 },
            { 2172.91522875294, 3.24560604541697, 67.3698793267690 },
            { 2173.32105656936, 4.51492766334954, 15.3342036804303 },
            { 2194.19130344853, 9.29550017181743, 2.58282898673850 },
        },
        { // Spliter
            { 2270.68938959351, 37.9134303748408, 28.7249561960703 },
            { 2299.42003518075, 7.08541294178821, 2287.86436377334 },
        }
    };

    const Indices peakIndices = { 0, 0, 0, 0, 0, 0, 0, 216, 0, 0, 0, 0, 0, 0, 375 };
    const Indices clearPeakIndices = { 7, 14 };
    const Index segmentIndex = 1;

    Spectrum segment = ExtractSegment(spectrum, peakIndices, clearPeakIndices,
        segmentIndex, splitters);

    constexpr size_t correctSegmentLength = 86;
    ASSERT_EQ(correctSegmentLength, segment.mzs.size());

    EXPECT_NEAR(2178.41784178418, segment.mzs[0], MAX_ERROR);
    EXPECT_NEAR(2179.21792179218, segment.mzs[1], MAX_ERROR);
    EXPECT_NEAR(2180.01800180018, segment.mzs[2], MAX_ERROR);
    EXPECT_NEAR(2286.42864286429, segment.mzs[83], MAX_ERROR);
    EXPECT_NEAR(2287.22872287229, segment.mzs[84], MAX_ERROR);
    EXPECT_NEAR(2288.02880288029, segment.mzs[85], MAX_ERROR);

    EXPECT_NEAR(0.0104103037322122, segment.intensities[0], MAX_ERROR);
    EXPECT_NEAR(0.1082741531312020, segment.intensities[1], MAX_ERROR);
    EXPECT_NEAR(0.0431182962200357, segment.intensities[2], MAX_ERROR);
    EXPECT_NEAR(4.3570129304619500, segment.intensities[83], MAX_ERROR);
    EXPECT_NEAR(3.5315608145730300, segment.intensities[84], MAX_ERROR);
    EXPECT_NEAR(1.6087782931920000, segment.intensities[85], MAX_ERROR);
}

TEST_F(SegmentExtractorTest, correctly_decomposes_last_segment)
{
    constexpr DataType MAX_ERROR = 0.0001;

    Spectrum spectrum;
    spectrum.mzs = {
        9170.31703170317, 9171.11711171117, 9171.91719171917, 9172.71727172717,
        9173.51735173517, 9174.31743174317, 9175.11751175117, 9175.91759175918,
        9176.71767176718, 9177.51775177518, 9178.31783178318, 9179.11791179118,
        9179.91799179918, 9180.71807180718, 9181.51815181518, 9182.31823182318,
        9183.11831183118, 9183.91839183918, 9184.71847184718, 9185.51855185518,
        9186.31863186319, 9187.11871187119, 9187.91879187919, 9188.71887188719,
        9189.51895189519, 9190.31903190319, 9191.11911191119, 9191.91919191919,
        9192.71927192719, 9193.51935193519, 9194.31943194319, 9195.11951195119,
        9195.91959195920, 9196.71967196720, 9197.51975197520, 9198.31983198320,
        9199.11991199120, 9199.91999199920, 9200.72007200720, 9201.52015201520,
        9202.32023202320, 9203.12031203120, 9203.92039203920, 9204.72047204720,
        9205.52055205520, 9206.32063206321, 9207.12071207121, 9207.92079207921,
        9208.72087208721, 9209.52095209521, 9210.32103210321, 9211.12111211121,
        9211.92119211921, 9212.72127212721, 9213.52135213521, 9214.32143214321,
        9215.12151215121, 9215.92159215922, 9216.72167216722, 9217.52175217522,
        9218.32183218322, 9219.12191219122, 9219.92199219922, 9220.72207220722,
        9221.52215221522, 9222.32223222322, 9223.12231223122, 9223.92239223922,
        9224.72247224722, 9225.52255225523, 9226.32263226323, 9227.12271227123,
        9227.92279227923, 9228.72287228723, 9229.52295229523, 9230.32303230323,
        9231.12311231123, 9231.92319231923, 9232.72327232723, 9233.52335233523,
        9234.32343234323, 9235.12351235123, 9235.92359235924, 9236.72367236724,
        9237.52375237524, 9238.32383238324, 9239.12391239124, 9239.92399239924,
        9240.72407240724, 9241.52415241524, 9242.32423242324, 9243.12431243124,
        9243.92439243924, 9244.72447244724, 9245.52455245525, 9246.32463246325,
        9247.12471247125, 9247.92479247925, 9248.72487248725, 9249.52495249525,
        9250.32503250325, 9251.12511251125, 9251.92519251925, 9252.72527252725,
        9253.52535253525, 9254.32543254325, 9255.12551255125, 9255.92559255926,
        9256.72567256726, 9257.52575257526, 9258.32583258326, 9259.12591259126,
        9259.92599259926, 9260.72607260726, 9261.52615261526, 9262.32623262326,
        9263.12631263126, 9263.92639263926, 9264.72647264726, 9265.52655265527,
        9266.32663266327, 9267.12671267127, 9267.92679267927, 9268.72687268727,
        9269.52695269527, 9270.32703270327, 9271.12711271127, 9271.92719271927,
        9272.72727272727, 9273.52735273527, 9274.32743274327, 9275.12751275127,
        9275.92759275928, 9276.72767276728, 9277.52775277528, 9278.32783278328,
        9279.12791279128, 9279.92799279928, 9280.72807280728, 9281.52815281528,
        9282.32823282328, 9283.12831283128, 9283.92839283928, 9284.72847284728,
        9285.52855285529, 9286.32863286329, 9287.12871287129, 9287.92879287929,
        9288.72887288729, 9289.52895289529, 9290.32903290329, 9291.12911291129,
        9291.92919291929, 9292.72927292729, 9293.52935293529, 9294.32943294329,
        9295.12951295130, 9295.92959295930, 9296.72967296730, 9297.52975297530,
        9298.32983298330, 9299.12991299130, 9299.92999299930, 9300.73007300730,
        9301.53015301530, 9302.33023302330, 9303.13031303130, 9303.93039303930,
        9304.73047304730, 9305.53055305531, 9306.33063306331, 9307.13071307131,
        9307.93079307931, 9308.73087308731, 9309.53095309531, 9310.33103310331,
        9311.13111311131, 9311.93119311931, 9312.73127312731, 9313.53135313531,
        9314.33143314331, 9315.13151315132, 9315.93159315932, 9316.73167316732,
        9317.53175317532, 9318.33183318332, 9319.13191319132, 9319.93199319932,
        9320.73207320732, 9321.53215321532, 9322.33223322332, 9323.13231323132,
        9323.93239323932, 9324.73247324732, 9325.53255325533, 9326.33263326333,
        9327.13271327133, 9327.93279327933, 9328.73287328733, 9329.53295329533,
        9330.33303330333, 9331.13311331133, 9331.93319331933, 9332.73327332733,
        9333.53335333533, 9334.33343334333, 9335.13351335134, 9335.93359335934,
        9336.73367336734, 9337.53375337534, 9338.33383338334, 9339.13391339134,
        9339.93399339934, 9340.73407340734, 9341.53415341534, 9342.33423342334,
        9343.13431343134, 9343.93439343934, 9344.73447344734, 9345.53455345535,
        9346.33463346335, 9347.13471347135, 9347.93479347935, 9348.73487348735,
        9349.53495349535, 9350.33503350335, 9351.13511351135, 9351.93519351935,
        9352.73527352735, 9353.53535353535, 9354.33543354335, 9355.13551355136,
        9355.93559355936, 9356.73567356736, 9357.53575357536, 9358.33583358336,
        9359.13591359136, 9359.93599359936, 9360.73607360736, 9361.53615361536,
        9362.33623362336, 9363.13631363136, 9363.93639363936, 9364.73647364737,
        9365.53655365537, 9366.33663366337, 9367.13671367137, 9367.93679367937,
        9368.73687368737, 9369.53695369537, 9370.33703370337, 9371.13711371137,
        9371.93719371937, 9372.73727372737, 9373.53735373537, 9374.33743374337,
        9375.13751375138, 9375.93759375938, 9376.73767376738, 9377.53775377538,
        9378.33783378338, 9379.13791379138, 9379.93799379938, 9380.73807380738,
        9381.53815381538, 9382.33823382338, 9383.13831383138, 9383.93839383938,
        9384.73847384739, 9385.53855385539, 9386.33863386339, 9387.13871387139,
        9387.93879387939, 9388.73887388739, 9389.53895389539, 9390.33903390339,
        9391.13911391139, 9391.93919391939, 9392.73927392739, 9393.53935393539,
        9394.33943394339, 9395.13951395140, 9395.93959395940, 9396.73967396740,
        9397.53975397540, 9398.33983398340, 9399.13991399140, 9399.93999399940,
        9400.74007400740, 9401.54015401540, 9402.34023402340, 9403.14031403140,
        9403.94039403940, 9404.74047404741, 9405.54055405541, 9406.34063406341,
        9407.14071407141, 9407.94079407941, 9408.74087408741, 9409.54095409541,
        9410.34103410341, 9411.14111411141, 9411.94119411941, 9412.74127412741,
        9413.54135413541, 9414.34143414342, 9415.14151415142, 9415.94159415942,
        9416.74167416742, 9417.54175417542, 9418.34183418342, 9419.14191419142,
        9419.94199419942, 9420.74207420742, 9421.54215421542, 9422.34223422342,
        9423.14231423142, 9423.94239423942, 9424.74247424743, 9425.54255425543,
        9426.34263426343, 9427.14271427143, 9427.94279427943, 9428.74287428743,
        9429.54295429543, 9430.34303430343, 9431.14311431143, 9431.94319431943,
        9432.74327432743, 9433.54335433543, 9434.34343434344, 9435.14351435144,
        9435.94359435944, 9436.74367436744, 9437.54375437544, 9438.34383438344,
        9439.14391439144, 9439.94399439944, 9440.74407440744, 9441.54415441544,
        9442.34423442344, 9443.14431443144, 9443.94439443944, 9444.74447444745,
        9445.54455445545, 9446.34463446345, 9447.14471447145, 9447.94479447945,
        9448.74487448745, 9449.54495449545, 9450.34503450345, 9451.14511451145,
        9451.94519451945, 9452.74527452745, 9453.54535453545, 9454.34543454346,
        9455.14551455146, 9455.94559455946, 9456.74567456746, 9457.54575457546,
        9458.34583458346, 9459.14591459146, 9459.94599459946, 9460.74607460746,
        9461.54615461546, 9462.34623462346, 9463.14631463146, 9463.94639463946,
        9464.74647464747, 9465.54655465547, 9466.34663466347, 9467.14671467147,
        9467.94679467947, 9468.74687468747, 9469.54695469547, 9470.34703470347,
        9471.14711471147, 9471.94719471947, 9472.74727472747, 9473.54735473547,
        9474.34743474348, 9475.14751475148, 9475.94759475948, 9476.74767476748,
        9477.54775477548, 9478.34783478348, 9479.14791479148, 9479.94799479948,
        9480.74807480748, 9481.54815481548, 9482.34823482348, 9483.14831483148,
        9483.94839483949, 9484.74847484749, 9485.54855485549, 9486.34863486349,
        9487.14871487149, 9487.94879487949, 9488.74887488749, 9489.54895489549,
        9490.34903490349, 9491.14911491149, 9491.94919491949, 9492.74927492749,
        9493.54935493549, 9494.34943494350, 9495.14951495150, 9495.94959495950,
        9496.74967496750, 9497.54975497550, 9498.34983498350, 9499.14991499150,
        9499.94999499950, 9500.75007500750, 9501.55015501550, 9502.35023502350,
        9503.15031503150, 9503.95039503951, 9504.75047504751, 9505.55055505551,
        9506.35063506351, 9507.15071507151, 9507.95079507951, 9508.75087508751,
        9509.55095509551, 9510.35103510351, 9511.15111511151, 9511.95119511951,
        9512.75127512751, 9513.55135513551, 9514.35143514352, 9515.15151515152,
        9515.95159515952, 9516.75167516752, 9517.55175517552, 9518.35183518352,
        9519.15191519152, 9519.95199519952, 9520.75207520752, 9521.55215521552,
        9522.35223522352, 9523.15231523152, 9523.95239523953, 9524.75247524753,
        9525.55255525553, 9526.35263526353, 9527.15271527153, 9527.95279527953,
        9528.75287528753, 9529.55295529553, 9530.35303530353, 9531.15311531153,
        9531.95319531953, 9532.75327532753, 9533.55335533553, 9534.35343534354,
        9535.15351535154, 9535.95359535954, 9536.75367536754, 9537.55375537554,
        9538.35383538354, 9539.15391539154, 9539.95399539954, 9540.75407540754,
        9541.55415541554, 9542.35423542354, 9543.15431543154, 9543.95439543955,
        9544.75447544755, 9545.55455545555, 9546.35463546355, 9547.15471547155,
        9547.95479547955, 9548.75487548755, 9549.55495549555, 9550.35503550355,
        9551.15511551155, 9551.95519551955, 9552.75527552755, 9553.55535553556,
        9554.35543554356, 9555.15551555156, 9555.95559555956, 9556.75567556756,
        9557.55575557556, 9558.35583558356, 9559.15591559156, 9559.95599559956,
        9560.75607560756, 9561.55615561556, 9562.35623562356, 9563.15631563156,
        9563.95639563957, 9564.75647564757, 9565.55655565557, 9566.35663566357,
        9567.15671567157, 9567.95679567957, 9568.75687568757, 9569.55695569557,
        9570.35703570357, 9571.15711571157, 9571.95719571957, 9572.75727572757,
        9573.55735573558, 9574.35743574358, 9575.15751575158, 9575.95759575958,
        9576.75767576758, 9577.55775577558, 9578.35783578358, 9579.15791579158,
        9579.95799579958, 9580.75807580758, 9581.55815581558, 9582.35823582358,
        9583.15831583158, 9583.95839583959, 9584.75847584759, 9585.55855585559,
        9586.35863586359, 9587.15871587159, 9587.95879587959, 9588.75887588759,
        9589.55895589559, 9590.35903590359, 9591.15911591159, 9591.95919591959,
        9592.75927592759, 9593.55935593560, 9594.35943594360, 9595.15951595160,
        9595.95959595960, 9596.75967596760, 9597.55975597560, 9598.35983598360,
        9599.15991599160, 9599.95999599960, 9600.76007600760, 9601.56015601560,
        9602.36023602360, 9603.16031603160, 9603.96039603961, 9604.76047604761,
        9605.56055605561, 9606.36063606361, 9607.16071607161, 9607.96079607961,
        9608.76087608761, 9609.56095609561, 9610.36103610361, 9611.16111611161,
        9611.96119611961, 9612.76127612761, 9613.56135613562, 9614.36143614362,
        9615.16151615162, 9615.96159615962, 9616.76167616762, 9617.56175617562,
        9618.36183618362, 9619.16191619162, 9619.96199619962, 9620.76207620762,
        9621.56215621562, 9622.36223622362, 9623.16231623162, 9623.96239623962,
        9624.76247624762, 9625.56255625563, 9626.36263626363, 9627.16271627163,
        9627.96279627963, 9628.76287628763, 9629.56295629563, 9630.36303630363,
        9631.16311631163, 9631.96319631963, 9632.76327632763, 9633.56335633563,
        9634.36343634363, 9635.16351635164, 9635.96359635964, 9636.76367636764,
        9637.56375637564, 9638.36383638364, 9639.16391639164, 9639.96399639964,
        9640.76407640764, 9641.56415641564, 9642.36423642364, 9643.16431643164,
        9643.96439643964, 9644.76447644764, 9645.56455645565, 9646.36463646365,
        9647.16471647165, 9647.96479647965, 9648.76487648765, 9649.56495649565,
        9650.36503650365, 9651.16511651165, 9651.96519651965, 9652.76527652765,
        9653.56535653565, 9654.36543654365, 9655.16551655166, 9655.96559655966,
        9656.76567656766, 9657.56575657566, 9658.36583658366, 9659.16591659166,
        9659.96599659966, 9660.76607660766, 9661.56615661566, 9662.36623662366,
        9663.16631663166, 9663.96639663966, 9664.76647664767, 9665.56655665567,
        9666.36663666367, 9667.16671667167, 9667.96679667967, 9668.76687668767,
        9669.56695669567, 9670.36703670367, 9671.16711671167, 9671.96719671967,
        9672.76727672767, 9673.56735673567, 9674.36743674367, 9675.16751675168,
        9675.96759675968, 9676.76767676768, 9677.56775677568, 9678.36783678368,
        9679.16791679168, 9679.96799679968, 9680.76807680768, 9681.56815681568,
        9682.36823682368, 9683.16831683168, 9683.96839683968, 9684.76847684769,
        9685.56855685569, 9686.36863686369, 9687.16871687169, 9687.96879687969,
        9688.76887688769, 9689.56895689569, 9690.36903690369, 9691.16911691169,
        9691.96919691969, 9692.76927692769, 9693.56935693569, 9694.36943694369,
        9695.16951695170, 9695.96959695970, 9696.76967696770, 9697.56975697570,
        9698.36983698370, 9699.16991699170, 9699.96999699970, 9700.77007700770,
        9701.57015701570, 9702.37023702370, 9703.17031703170, 9703.97039703970,
        9704.77047704771, 9705.57055705571, 9706.37063706371, 9707.17071707171,
        9707.97079707971, 9708.77087708771, 9709.57095709571, 9710.37103710371,
        9711.17111711171, 9711.97119711971, 9712.77127712771, 9713.57135713571,
        9714.37143714372, 9715.17151715172, 9715.97159715972, 9716.77167716772,
        9717.57175717572, 9718.37183718372, 9719.17191719172, 9719.97199719972,
        9720.77207720772, 9721.57215721572, 9722.37223722372, 9723.17231723172,
        9723.97239723972, 9724.77247724773, 9725.57255725573, 9726.37263726373,
        9727.17271727173, 9727.97279727973, 9728.77287728773, 9729.57295729573,
        9730.37303730373, 9731.17311731173, 9731.97319731973, 9732.77327732773,
        9733.57335733573, 9734.37343734374, 9735.17351735174, 9735.97359735974,
        9736.77367736774, 9737.57375737574, 9738.37383738374, 9739.17391739174,
        9739.97399739974, 9740.77407740774, 9741.57415741574, 9742.37423742374,
        9743.17431743174, 9743.97439743974, 9744.77447744775, 9745.57455745575,
        9746.37463746375, 9747.17471747175, 9747.97479747975, 9748.77487748775,
        9749.57495749575, 9750.37503750375, 9751.17511751175, 9751.97519751975,
        9752.77527752775, 9753.57535753575, 9754.37543754376, 9755.17551755176,
        9755.97559755976, 9756.77567756776, 9757.57575757576, 9758.37583758376,
        9759.17591759176, 9759.97599759976, 9760.77607760776, 9761.57615761576,
        9762.37623762376, 9763.17631763176, 9763.97639763976, 9764.77647764777,
        9765.57655765577, 9766.37663766377, 9767.17671767177, 9767.97679767977,
        9768.77687768777, 9769.57695769577, 9770.37703770377, 9771.17711771177,
        9771.97719771977, 9772.77727772777, 9773.57735773577, 9774.37743774377,
        9775.17751775177, 9775.97759775978, 9776.77767776778, 9777.57775777578,
        9778.37783778378, 9779.17791779178, 9779.97799779978, 9780.77807780778,
        9781.57815781578, 9782.37823782378, 9783.17831783178, 9783.97839783978,
        9784.77847784778, 9785.57855785578, 9786.37863786379, 9787.17871787179,
        9787.97879787979, 9788.77887788779, 9789.57895789579, 9790.37903790379,
        9791.17911791179, 9791.97919791979, 9792.77927792779, 9793.57935793579,
        9794.37943794379, 9795.17951795179, 9795.97959795980, 9796.77967796780,
        9797.57975797580, 9798.37983798380, 9799.17991799180, 9799.97999799980,
        9800.78007800780, 9801.58015801580, 9802.38023802380, 9803.18031803180,
        9803.98039803980, 9804.78047804780, 9805.58055805580, 9806.38063806381,
        9807.18071807181, 9807.98079807981, 9808.78087808781, 9809.58095809581,
        9810.38103810381, 9811.18111811181, 9811.98119811981, 9812.78127812781,
        9813.58135813581, 9814.38143814381, 9815.18151815181, 9815.98159815982,
        9816.78167816782, 9817.58175817582, 9818.38183818382, 9819.18191819182,
        9819.98199819982, 9820.78207820782, 9821.58215821582, 9822.38223822382,
        9823.18231823182, 9823.98239823982, 9824.78247824782, 9825.58255825583,
        9826.38263826383, 9827.18271827183, 9827.98279827983, 9828.78287828783,
        9829.58295829583, 9830.38303830383, 9831.18311831183, 9831.98319831983,
        9832.78327832783, 9833.58335833583, 9834.38343834383, 9835.18351835183,
        9835.98359835984, 9836.78367836784, 9837.58375837584, 9838.38383838384,
        9839.18391839184, 9839.98399839984, 9840.78407840784, 9841.58415841584,
        9842.38423842384, 9843.18431843184, 9843.98439843984, 9844.78447844784,
        9845.58455845585, 9846.38463846385, 9847.18471847185, 9847.98479847985,
        9848.78487848785, 9849.58495849585, 9850.38503850385, 9851.18511851185,
        9851.98519851985, 9852.78527852785, 9853.58535853585, 9854.38543854385,
        9855.18551855185, 9855.98559855986, 9856.78567856786, 9857.58575857586,
        9858.38583858386, 9859.18591859186, 9859.98599859986, 9860.78607860786,
        9861.58615861586, 9862.38623862386, 9863.18631863186, 9863.98639863986,
        9864.78647864786, 9865.58655865587, 9866.38663866387, 9867.18671867187,
        9867.98679867987, 9868.78687868787, 9869.58695869587, 9870.38703870387,
        9871.18711871187, 9871.98719871987, 9872.78727872787, 9873.58735873587,
        9874.38743874387, 9875.18751875187, 9875.98759875988, 9876.78767876788,
        9877.58775877588, 9878.38783878388, 9879.18791879188, 9879.98799879988,
        9880.78807880788, 9881.58815881588, 9882.38823882388, 9883.18831883188,
        9883.98839883988, 9884.78847884788, 9885.58855885589, 9886.38863886389,
        9887.18871887189, 9887.98879887989, 9888.78887888789, 9889.58895889589,
        9890.38903890389, 9891.18911891189, 9891.98919891989, 9892.78927892789,
        9893.58935893589, 9894.38943894389, 9895.18951895190, 9895.98959895990,
        9896.78967896790, 9897.58975897590, 9898.38983898390, 9899.18991899190,
        9899.98999899990, 9900.79007900790, 9901.59015901590, 9902.39023902390,
        9903.19031903190, 9903.99039903990, 9904.79047904790, 9905.59055905591,
        9906.39063906391, 9907.19071907191, 9907.99079907991, 9908.79087908791,
        9909.59095909591, 9910.39103910391, 9911.19111911191, 9911.99119911991,
        9912.79127912791, 9913.59135913591, 9914.39143914391, 9915.19151915192,
        9915.99159915992, 9916.79167916792, 9917.59175917592, 9918.39183918392,
        9919.19191919192, 9919.99199919992, 9920.79207920792, 9921.59215921592,
        9922.39223922392, 9923.19231923192, 9923.99239923992, 9924.79247924792,
        9925.59255925593, 9926.39263926393, 9927.19271927193, 9927.99279927993,
        9928.79287928793, 9929.59295929593, 9930.39303930393, 9931.19311931193,
        9931.99319931993, 9932.79327932793, 9933.59335933593, 9934.39343934393,
        9935.19351935194, 9935.99359935994, 9936.79367936794, 9937.59375937594,
        9938.39383938394, 9939.19391939194, 9939.99399939994, 9940.79407940794,
        9941.59415941594, 9942.39423942394, 9943.19431943194, 9943.99439943994,
        9944.79447944794, 9945.59455945595, 9946.39463946395, 9947.19471947195,
        9947.99479947995, 9948.79487948795, 9949.59495949595, 9950.39503950395,
        9951.19511951195, 9951.99519951995, 9952.79527952795, 9953.59535953595,
        9954.39543954395, 9955.19551955196, 9955.99559955996, 9956.79567956796,
        9957.59575957596, 9958.39583958396, 9959.19591959196, 9959.99599959996,
        9960.79607960796, 9961.59615961596, 9962.39623962396, 9963.19631963196,
        9963.99639963996, 9964.79647964797, 9965.59655965597, 9966.39663966397,
        9967.19671967197, 9967.99679967997, 9968.79687968797, 9969.59695969597,
        9970.39703970397, 9971.19711971197, 9971.99719971997, 9972.79727972797,
        9973.59735973597, 9974.39743974397, 9975.19751975198, 9975.99759975998,
        9976.79767976798, 9977.59775977598, 9978.39783978398, 9979.19791979198,
        9979.99799979998, 9980.79807980798, 9981.59815981598, 9982.39823982398,
        9983.19831983198, 9983.99839983998, 9984.79847984799, 9985.59855985599,
        9986.39863986399, 9987.19871987199, 9987.99879987999, 9988.79887988799,
        9989.59895989599, 9990.39903990399, 9991.19911991199, 9991.99919991999,
        9992.79927992799, 9993.59935993599, 9994.39943994399, 9995.19951995200,
        9995.99959996000, 9996.79967996800, 9997.59975997600, 9998.39983998400,
        9999.19991999200, 10000
    };
    spectrum.intensities = {
        41.8453404718095, 41.7824493756364, 41.1564571408291, 41.1120983750504,
        41.2898540983310, 41.1494947750677, 40.8771227216920, 40.5001457595308,
        40.1440573639677, 39.6531481194386, 38.9955809571571, 38.8238516634086,
        38.5259163650148, 37.9357185626878, 37.9982874676166, 37.9843557223739,
        36.9630689992834, 35.9733110253764, 35.6065138686369, 35.4831071004560,
        35.2685031651414, 34.3873833202399, 33.2300320844787, 32.6690201733221,
        32.6485878541096, 32.5013053194384, 31.9047776181830, 30.9825270743681,
        29.9299731123272, 29.1876662685093, 28.6825355566315, 28.0841303789680,
        27.6853445267474, 27.4824181141234, 27.3022711246561, 26.9517563371725,
        25.8260868020194, 24.4742562770089, 23.8669181751202, 23.6701929753034,
        23.1357289831507, 22.2516044702571, 21.7353275264162, 21.7496437876682,
        21.5469705865596, 20.8211099989358, 20.0160140863383, 19.2389880579078,
        18.2076862011045, 17.2234625411229, 17.0066514070494, 16.9849600730284,
        16.5234429916694, 16.1765585442423, 16.0908122974082, 15.7021819835942,
        15.0095190652459, 14.2401809646927, 13.6171598698524, 13.4719048414194,
        13.4849110423291, 13.0013884396272, 12.1413234245378, 11.5638447316842,
        11.2896761878455, 10.8448573420163, 10.4458904990961, 10.3107977148853,
        10.1280121108771, 9.85804500129042, 9.60470264648733, 9.00787834318234,
        7.96656873040062, 7.29927794821618, 7.26501547740010, 7.06187734858580,
        6.53325835718203, 6.25267751218890, 6.33584397415692, 6.42256430328680,
        6.31990908204674, 5.91939049439293, 5.38631010109540, 5.04053679208254,
        4.71464219427735, 4.32919293740268, 4.18127202777242, 4.27705309980629,
        4.44493007129275, 4.47020409559211, 4.14917567397502, 3.75497404137094,
        3.52548512471040, 3.45707460275624, 3.51961425870929, 3.62787531419343,
        3.63502802990782, 3.33460152252015, 3.00872224976692, 3.06236511672989,
        3.20349016608267, 3.07743947501465, 2.74560256185936, 2.51748429696312,
        2.70936843180630, 3.04391996426779, 3.02596832604783, 2.83872982161156,
        2.77283461578719, 2.83934364085582, 2.65494249928384, 2.34970833366156,
        2.61926156069515, 2.90548383925304, 2.75393785506772, 2.96231614301943,
        3.11778729946023, 2.80506596071880, 2.65154100845018, 2.65066022179625,
        2.40179492883231, 2.33230343668935, 2.63585695849078, 2.75237277211603,
        2.77507630662034, 3.03941452357526, 3.22839940552081, 3.08068156299825,
        2.88925017438363, 2.83924068529209, 2.89043461345075, 2.98366865147083,
        3.11210783409818, 3.13963789927285, 2.93665782027292, 2.76629664726764,
        2.87234179196885, 3.10762752064757, 3.12573415531316, 2.96093502536999,
        3.00628098387932, 3.24887180470385, 3.37561854168683, 3.29176774715898,
        3.21052602402167, 3.32546593688482, 3.40878253304639, 3.45283503658820,
        3.42164631648743, 3.15322774172245, 3.09296997077230, 3.42660510158337,
        3.62497809260707, 3.40632974589284, 3.16571839770370, 3.30603112930735,
        3.52731833215283, 3.54124301633471, 3.43643302634451, 3.44280832258235,
        3.63964157657259, 3.77451917204932, 3.74177493089066, 3.77670116126216,
        3.88858207933548, 3.91930331885008, 3.76885138056897, 3.73133770602598,
        4.05598432324597, 4.32281616152259, 4.44946042166306, 4.71962572730138,
        4.58608552104682, 4.23456537588118, 4.35732721453159, 4.54949674174021,
        4.36658437496265, 4.22890290740095, 4.46093270509433, 5.00816553535198,
        5.48146296912606, 5.42147376997456, 5.29885149028699, 5.65208296228192,
        6.00945667731199, 6.18251066369718, 6.40675073061826, 6.41635366770492,
        6.29612617614734, 6.67768055724480, 7.31135861349434, 7.45026630084054,
        7.47142101124503, 7.90547125505541, 8.25469350713786, 8.44735796198985,
        8.76299821204410, 8.94682298649988, 8.98183358616162, 9.17964034482398,
        9.74227520708421, 10.2039365227834, 10.3733376535814, 10.9146899984964,
        11.5952426865074, 11.8799655599503, 12.3005385707445, 12.7320474905376,
        12.8534633987220, 13.0007699149682, 13.5054231368684, 14.2670401618085,
        14.7360674396100, 14.7190584099654, 14.8872435761503, 15.5102251589178,
        16.2912496754253, 16.7438904543729, 16.8014129782729, 17.0198862114090,
        17.7328940751236, 18.3880193067091, 18.5979834420020, 18.9068148186005,
        19.5630052226651, 20.3202652714705, 21.0518819881826, 21.8773357749785,
        22.5041953987271, 22.4370271526785, 22.4845031592931, 23.2842581953521,
        24.1516181374512, 24.8301577287308, 25.3678174562353, 25.5597217944654,
        25.5087601749947, 25.6328535882130, 26.1199840288661, 26.6284660710116,
        26.9789750704976, 27.4225500498767, 28.1003511924812, 28.9959499442944,
        29.8824903859117, 30.2403841322278, 30.2493653965840, 30.9116734659864,
        31.8023621162768, 31.8491297822588, 31.3921112385988, 31.4287607035324,
        32.0583437474219, 32.8143691875245, 33.5707151803423, 34.3590023279476,
        34.7815991988683, 34.8896171462927, 35.4103970949853, 36.2447101861174,
        36.5207236099215, 36.2525977863166, 36.1787090103934, 36.5236295416767,
        36.7725231554370, 36.8187216055459, 37.3100462886202, 37.8263319550647,
        37.4837117961312, 37.0299816268099, 37.4879841841647, 38.4129946597511,
        38.7649650121328, 38.3500186889117, 38.1403125206187, 38.1186963527206,
        37.7223011524546, 37.2574002453692, 36.9525846981859, 36.7572109826777,
        37.3120279456415, 38.3880089373805, 38.2760302033827, 37.0875765026299,
        36.1740016872089, 35.9484633176900, 35.9051295462178, 35.6282949048478,
        35.1349879886329, 34.8029293446589, 34.7702735156299, 34.3631380162022,
        33.5048869267972, 32.9414649971321, 32.5963475311642, 31.7675537404454,
        30.9142881523852, 30.9775739076497, 31.2291009194233, 30.2251081180007,
        28.7349110167986, 27.6095152513859, 26.8002096067447, 26.2459167619475,
        25.5228820863995, 24.5952106922438, 24.1927212343618, 24.0229094013103,
        23.0796631864547, 21.9989010750279, 21.4982853761284, 20.9457659663973,
        19.9405883184232, 19.1024790896486, 18.5571757964963, 17.9684903612359,
        17.3983110894445, 16.7747666733827, 16.0418592356785, 15.5500889080737,
        15.2945485463660, 14.6438509535058, 13.6415978478317, 12.9845196923927,
        12.5031790435745, 12.0623135775840, 11.9728076110293, 11.5484801208695,
        10.6401180047657, 9.99499181421392, 9.49000361792139, 8.59878634750204,
        7.75828033928168, 7.54219041076638, 7.67051914572370, 7.35615242969426,
        6.46025929423181, 5.71412208796433, 5.59543323661681, 5.66159660450022,
        5.44506365237083, 5.00371585436159, 4.54985447917475, 4.16181609666848,
        3.84779286546868, 3.74305147861914, 3.67720484474185, 3.37084396924680,
        3.09725885429993, 2.98713902370477, 2.71738587230308, 2.27825558496514,
        1.88424398858901, 1.80022650808054, 1.90665284531101, 1.70740863667092,
        1.39079514819974, 1.31324326597296, 1.33431922437016, 1.38190336542322,
        1.38832856226494, 1.23293846388534, 0.988859344938865, 0.781815050007241,
        0.740932496253889, 0.732673064671816, 0.632664642834339, 0.615255041171193,
        0.735416362972328, 0.726225576032907, 0.315071721498202, 0, 0, 0,
        0.168544335922507, 0.260760118176967, 0.227245004408404, 0.0517142750447324,
        0, 0.136832219689839, 0.163263858208626, 0, 0, 0, 0, 0, 0.0365686515483861,
        0.109101713143133, 0.0261703962210799, 0, 0, 0.141905784681667,
        0.0790763602709897, 0, 0, 0, 0, 0.0391754429864992, 0.164490883901697,
        0.131789162468787, 0, 0, 0, 0.0300782125815481, 0.0528834609146327, 0, 0,
        0.0408372476861922, 0.187365198458086, 0, 0, 0, 0.0138548716063638, 0, 0,
        0.0911529193860295, 0, 0, 0, 0, 0.138663828119096, 0.0585806829052139, 0, 0,
        0.0178992004132583, 0, 0, 0, 0, 0, 0, 0, 0.356529425242529,
        0.199007619098549, 0, 0, 0, 0, 0, 0, 0.0198517301527687, 0,
        0.0146767545287969, 0.119819070221143, 0.0547391573527461,
        0.0351540301444702, 0.143615726408472, 0.0965119982844465, 0, 0,
        0.106790296673191, 0.305337745352055, 0.163098247843685, 0, 0, 0, 0, 0, 0,
        0, 0.0164132750107991, 0.0116947749678148, 0, 0, 0.0538730572242673,
        0.0161552088889141, 6.44917808589884e-05, 0, 0, 0, 0.185607837064236,
        0.0583679700731535, 0, 0, 0, 0.0854695677247644, 0.218734939065346,
        0.0744450538055528, 0, 0, 0, 0, 0.0813487292669212, 0.161413302022943,
        0.00999011023067786, 0, 0.160701141147332, 0.174502809306163, 0, 0,
        0.147524320904163, 0.257858491342476, 0.192444899432471, 0.0370015257048916,
        0, 0, 0.352655340507179, 0.513938728774897, 0.161736425715741, 0, 0, 0, 0,
        0, 0.226771180839294, 0.327182348140439, 0.211587140401725,
        0.0810773558294726, 0, 0, 0, 0.0303452602375572, 0.129433373256041,
        0.0316046102665936, 0, 0, 0.0290367893458345, 0, 0.0643494185548356,
        0.247457767064804, 0.146972352841987, 0, 0.0629577643035344,
        0.128909898438707, 0.178436746606145, 0.363336813623013, 0.436638743290511,
        0.175872543463448, 0, 0, 0.0974037065157829, 0.229751776893435,
        0.176790971276599, 0.0702065864383236, 0.160945834675148, 0.248618178036104,
        0.104091026110999, 0.0450614945068266, 0.0655579954648804,
        0.0595214796777339, 0.152698587710477, 0.0733510332991353, 0, 0,
        0.324672435949778, 0.327758111756098, 0.0782751155396535,
        0.0381596064028235, 0.158777839737966, 0.155859828148460, 0.120423496115891,
        0.139221584140247, 0.111727266365903, 0.0536489649165751,
        0.0829236909065632, 0.121878754770115, 0.121113547972371, 0.212631153475217,
        0.262541766035469, 0.0607826806927606, 0, 0, 0.124235349928835,
        0.290615532108919, 0, 0, 0.0761323250694322, 0.185188204563103,
        0.106729163017807, 0.122927560741099, 0.163118898169154, 0.227307174608399,
        0.305852286848023, 0.241109177137994, 0.0539578667135464, 0,
        0.0785328769577305, 0.195250162019249, 0.282836230266332, 0.476421999295855,
        0.528411881599759, 0.355825026944405, 0.170107970446309, 0.0179533187607820,
        0, 0.239727257626596, 0.566685088125378, 0.567793454090589,
        0.324203873075304, 0.144365236725843, 0.0963501866326627, 0.275366362583421,
        0.414788442410718, 0.248032497480470, 0.254296583523936, 0.437069684263018,
        0.308432907189667, 0.180742755882445, 0.289330104296624, 0.473158340656837,
        0.576519267954079, 0.341385293759596, 0.0564301878565193, 0.147314938994056,
        0.341005111589632, 0.380830417073418, 0.496504054096086, 0.590299343712428,
        0.491832401340329, 0.588798601740840, 0.769797664175999, 0.581423820300297,
        0.313289220055875, 0.416928029892567, 0.614526623782088, 0.640995841576730,
        0.693733155012515, 0.752466761326454, 0.739300519738355, 0.825300763642520,
        0.870438272024964, 0.821516725021696, 0.924857146438017, 1.01279708689374,
        0.936137155195181, 1.13528929386302, 1.60305038889332, 1.74110843493051,
        1.46156486707289, 1.21804759032064, 1.37694696182399, 1.85359424451743,
        2.15640864466465, 1.98804267484326, 1.65913276069131, 1.90798401915077,
        2.70266036090671, 2.98396828024911, 2.45948292927105, 2.08708456899720,
        2.32565038158051, 2.82105983920706, 3.08897684929222, 3.18557808551728,
        3.27013704308202, 3.33930935497011, 3.48957653837728, 3.79105207055089,
        4.16617420314417, 4.41125927657252, 4.49475964523171, 4.61930275949234,
        4.94412793791569, 5.33934654910817, 5.44478043078454, 5.19110274184762,
        5.14572989607536, 5.77649658216090, 6.47062727517915, 6.59258438429881,
        6.60201752145688, 6.79103828857487, 6.97899566931079, 7.17833384381314,
        7.48026044034339, 7.82950185653489, 8.20383479211944, 8.59333910065239,
        8.88510793648666, 8.93157901723680, 8.84161041501658, 8.96910449653750,
        9.43126495595346, 9.94104127325356, 10.1545851798963, 10.0332058773366,
        10.1251986894852, 10.9119691876649, 11.8029518480119, 11.9701634004646,
        12.0140751055090, 12.4953357886880, 12.9831539163290, 13.2040747462337,
        13.4329458738884, 13.6807510632023, 13.8651357239629, 14.0460033772383,
        14.0880847362845, 14.1147362153066, 14.5605999587437, 15.0415728751783,
        15.0511425614074, 15.0408512401713, 15.3179937229709, 15.5803672105514,
        15.9846449823964, 16.5892812487410, 16.9316315002264, 16.8794715510404,
        16.6437834594150, 16.6003493276985, 16.7736589483113, 16.8062180273919,
        16.8088700115291, 17.0026487499299, 17.1173223996450, 17.0268225608031,
        16.9708971676087, 17.0769104917854, 17.2623218682380, 17.4283735260904,
        17.4937923245330, 17.4498218446184, 17.4355444095734, 17.3620343894079,
        16.9995521011074, 16.5949716121140, 16.5241751283393, 16.6216560012397,
        16.7414359431844, 17.0777773492984, 17.2823335063248, 16.7454127401357,
        15.6724488248537, 15.2425024667846, 15.8085828259940, 16.2093577253486,
        15.8942235210756, 15.3285393821001, 14.8063209095092, 14.7974607314850,
        15.0716086073145, 14.6792904384872, 14.0468450286454, 13.9308940354375,
        13.9268912112528, 13.7376638862428, 13.4925152700920, 13.1959160787580,
        13.0068693577547, 12.7544793572805, 12.2651693707008, 12.0977016385735,
        11.9956189640538, 11.4160939920205, 10.8950866365704, 10.8492121181132,
        10.7637559097837, 10.4632678210531, 10.3712517032449, 10.4606087547621,
        10.2884462872380, 9.66063828984073, 8.87939939877679, 8.53215989869078,
        8.64589794923104, 8.58123230163085, 8.18772986453192, 7.70451968778545,
        7.16444158714454, 6.85234891873940, 6.89125498922008, 6.64347850693473,
        6.12857355927556, 6.05878418876980, 6.11799421397510, 5.70282184463347,
        5.24571950743220, 5.26515967296503, 5.34855313776860, 4.97963701989355,
        4.48010824434486, 4.46506863689509, 4.71171515785569, 4.51334116332045,
        4.05128597334412, 3.81837221508024, 3.74535754341329, 3.58310850576151,
        3.34022329006435, 3.18200651135218, 3.16171404899855, 3.11828837471186,
        2.99387471828179, 2.83303550825554, 2.60515895349086, 2.47817983892139,
        2.47894264603808, 2.32427774911863, 2.10577648479821, 2.07593673308448,
        2.10857487639335, 2.14634500861854, 2.19522885362621, 2.07541526285348,
        1.80068268050883, 1.59080740458067, 1.61827614886778, 1.77443343392157,
        1.67200602761534, 1.33942017617107, 1.18533296682589, 1.26128287070495,
        1.36065810474037, 1.46178954430611, 1.45500727035365, 1.21913969245489,
        1.10011705150088, 1.17919402086433, 1.21326389157906, 1.08611650285005,
        0.870518577671081, 0.850369367648922, 1.08533154555056, 1.21446437817890,
        1.08579865373026, 0.877064801155228, 0.801911245232635, 0.923288056529093,
        1.03570417780303, 1.02174760753962, 0.968679177556879, 0.879785836325719,
        0.720524905724156, 0.591784843890553, 0.738380908400932, 1.12146092046940,
        1.18081166564701, 0.835772574338031, 0.761510295701138, 0.907656108323812,
        0.862965952445033, 0.789318835864450, 0.910128757747337, 0.946469363324332,
        0.766545822308536, 0.717062494689444, 0.813108809678924, 0.737330403042999,
        0.676958019502106, 0.881193901688688, 1.06537513866922, 0.977554402609982,
        0.790488888179880, 0.798604697216057, 0.973623290999923, 1.14771681854294,
        1.14193793902541, 0.952837822838245, 0.969163632026805, 1.11271406931027,
        0.913657612664741, 0.739902407439995, 0.917111621047111, 1.05689092730210,
        0.836111475777561, 0.618948038578680, 0.822368835773668, 1.10656752909392,
        0.999654040125837, 0.748522753056574, 0.734094090505886, 0.808336225374187,
        0.838122181179879, 0.948822382940375, 1.05132168467506, 0.989418560242049,
        0.904442162191342, 0.946869709150995, 1.00367442505801, 0.971450313054013,
        0.903801694823162, 0.818008272164324, 0.731196163453801, 0.702589881751021,
        0.647125902030287, 0.620558340418441, 0.802930094981858, 0.998526287655803,
        0.963738351234815, 0.930973985751231, 1.05366097726095, 1.06440646469838,
        0.940736236296628, 0.960011278010149, 1.01669559960066, 0.922912941801760,
        0.856980194647252, 0.957181038072704, 1.06338399778292, 1.01214650090974,
        0.892808084153347, 0.840516458253243, 0.861237373388079, 0.910054439885790,
        0.916374400022880, 0.924772911804350, 0.999132786406513, 1.04426293898803,
        1.09386437577819, 1.14905875747554, 1.05391233507918, 0.974024188801653,
        1.04477093660187, 0.987868881845009, 0.935966828720283, 1.15882226448662,
        1.24013563972523, 1.02721707688366, 0.918370921101206, 0.996812565083003,
        1.14286380994278, 1.21809737979482, 1.15354005610245, 1.02492556774754,
        0.961157384612241, 0.973594041483802, 0.999692260042000, 1.06625678108308,
        1.11119154407645, 1.06041363353820, 1.01379379520516, 0.970326204622826,
        0.958757152622451, 1.03295206268869, 1.03502702866407, 0.978170836687227,
        1.04108451459811, 1.08068862419700, 1.02246073606496, 1.06203399409854,
        1.11635861383683, 1.05475712739393, 0.979260295036634, 1.01953963437863,
        1.22569427654460, 1.33121138108099, 1.14237121419427, 0.970406034029139,
        1.00765150194262, 1.13549083965704, 1.22180270668229, 1.05207562640016,
        0.893771543654913, 1.13971648704071, 1.36147462820663, 1.25061767506929,
        1.09415483707174, 1.04347392716110, 1.05889866586043, 1.14982874794487,
        1.19069782621305, 1.03967351051801, 0.911948941844842, 1.08163952761011,
        1.30594213667838, 1.32521992782778, 1.28340737994583, 1.24521003797492,
        1.17627683389391, 1.24448289092662, 1.42429737837144, 1.37010705668349,
        1.09077464931925, 1.00950074575077, 1.21325770618725, 1.33272168860599,
        1.27864361773797, 1.25988898734805, 1.21940034672026, 1.08827882956775,
        1.04313327809483, 1.17912726664828, 1.28761567872697, 1.16983864794188,
        1.05476817478722, 1.24768483237028, 1.43740263796406, 1.19658386969212,
        0.985312560718356, 1.18241349854282, 1.33156098767122, 1.21657505352676,
        1.15433876698396, 1.18843113746541, 1.13894635458301, 1.09477794542965,
        1.21279169437137, 1.30716504227732, 1.22088826836516, 1.23139160456891,
        1.28599260221505, 0.832779957168740, 0.841290681782885, 0.945059379074042,
        0.641363238674575, 0.528227684509555, 0.335727088730922, 0.117966967086298,
        0.288011717737989, 0.497022310110369, 0.367971070376876, 0, 0,
        0.226454620877396, 0.422878171744261, 0.280500787163894, 0.0278183042997444,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0
    };

    Splitters splitters = { // Splitters container
        { // Spliter (mean)          (std)            (height)
            { 9160.43729048344, 21.1790897253041, 1310.54376809906 },
            { 9186.95183615035, 27.7833370506022, 1603.41454212448 },
        }
    };

    const Indices peakIndices = { 0 };
    const Indices clearPeakIndices = { 0 };
    const Index segmentIndex = 1;

    Spectrum segment = ExtractSegment(spectrum, peakIndices, clearPeakIndices,
        segmentIndex, splitters);

    constexpr size_t correctSegmentLength = 857;
    ASSERT_EQ(correctSegmentLength, segment.mzs.size());

    EXPECT_NEAR(9212.72127212721, segment.mzs[0], MAX_ERROR);
    EXPECT_NEAR(9213.52135213521, segment.mzs[1], MAX_ERROR);
    EXPECT_NEAR(9214.32143214321, segment.mzs[2], MAX_ERROR);
    EXPECT_NEAR(9975.19751975198, segment.mzs[854], MAX_ERROR);
    EXPECT_NEAR(9975.99759975998, segment.mzs[855], MAX_ERROR);
    EXPECT_NEAR(9976.79767976798, segment.mzs[856], MAX_ERROR);

    EXPECT_NEAR(0.0292142425902249, segment.intensities[0], MAX_ERROR);
    EXPECT_NEAR(0.4493526835318790, segment.intensities[1], MAX_ERROR);
    EXPECT_NEAR(0.5595950070081930, segment.intensities[2], MAX_ERROR);
    EXPECT_NEAR(0.4228781717442610, segment.intensities[854], MAX_ERROR);
    EXPECT_NEAR(0.2805007871638940, segment.intensities[855], MAX_ERROR);
    EXPECT_NEAR(0.0278183042997444, segment.intensities[856], MAX_ERROR);
}
}
